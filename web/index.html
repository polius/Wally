<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wally | Dashboards</title>
  <link rel="icon" type="image/png" href="assets/wally.png">
  <meta name="robots" content="index,follow" />
  <meta name="description" content="A lightweight, self-hosted expense tracker that makes it easy to manage your finances." />
  <meta property="author" content="Pol Alzina" />
  <meta property="og:title" content="Wally" />
  <meta property="og:description" content="A lightweight, self-hosted expense tracker that makes it easy to manage your finances." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="assets/wally.png" />
  <!-- CSS -->
  <link href="css/vendors/bootstrap.min.css" rel="stylesheet">
  <link href="css/vendors/tom-select.min.css" rel="stylesheet">
  <link href="css/vendors/tom-select.bootstrap5.min.css" rel="stylesheet">
  <link href="css/index.css" rel="stylesheet">
  <!-- JS -->
  <script src="js/vendors/bootstrap.bundle.min.js" defer></script>
  <script src="js/vendors/bootstrap-show-toast.js" defer></script>
  <script src="js/vendors/ag-grid-community.min.noStyle.js" defer></script>
  <script src="js/vendors/tom-select.complete.min.js"></script>
  <script src="js/vendors/chart.umd.min.js" defer></script>
  <script src="js/vendors/decimal.min.js" defer></script>
  <script src="js/i18n.js"></script>

  <script>
    (function() {
      const theme = localStorage.getItem('theme') || 'system';
      const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (theme === 'light' || (theme === 'system' && !systemPrefersDark)) {
        document.documentElement.setAttribute('data-bs-theme', 'light');
      }
      else {
        document.documentElement.setAttribute('data-bs-theme', 'dark');
      }
    })();
  </script>

</head>
<body data-i18n-document-title="dashboard.title">
  <!-- Header -->
  <header>
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light">
        <a class="navbar-brand d-flex align-items-center" style="margin-left:10px; margin-right:30px" href="/">
          <img src="assets/wally.png" alt="Wally" width="50" height="50" style="margin-bottom: 5px; margin-right: 8px;">
          <span style="font-size: 1.8rem; font-weight:600;">Wally</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item" style="margin-left: 10px"><a class="nav-link active" href="/" style="font-weight: 500" data-i18n="nav.dashboards">Dashboards</a></li>
            <li class="nav-item" style="margin-left: 10px"><a class="nav-link" href="transactions" data-i18n="nav.transactions">Transactions</a></li>
            <li class="nav-item" style="margin-left: 10px"><a class="nav-link" href="settings" data-i18n="nav.settings">Settings</a></li>
          </ul>
          <ul id="logoutButton" class="navbar-nav ms-auto" style="display: none;">
            <li class="nav-item nav-link" style="margin-left: 10px; cursor: pointer;" title="Logout" data-i18n-title="nav.logout_title" onclick="logout()">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--pill-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2" />
                <path d="M9 12h12l-3 -3" />
                <path d="M18 15l3 -3" />
              </svg>
            </li>
          </ul>
        </div>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container" style="margin-top: 0.5rem; margin-bottom: 0;">

    <!-- Month Header -->
    <div id="monthHeader" class="month-navigation">
      <div id="prevMonth" style="cursor: pointer;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="22" height="22" fill="currentColor">
          <path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 288 480 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-370.7 0 105.4-105.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/>
        </svg>
      </div>
      <div id="currentMonth" class="current-month"></div>
      <div id="nextMonth" style="cursor: pointer;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="22" height="22" fill="currentColor">
          <path d="M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l370.7 0-105.4 105.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z"/>
        </svg>
      </div>
    </div>
    <div id="monthHeaderAll" class="month-navigation current-month" style="display: none; height: 40px"></div>

    <!-- Action buttons -->
    <div class="d-flex justify-content-center align-items-center mb-4" style="margin-top: 20px">
      <button type="button" class="btn btn-success" style="font-size: 0.9rem; margin-right:5px; width: 150px; height:40px; border-radius: 100px" data-bs-toggle="modal" data-bs-target="#transactionModal" onclick="addTransaction()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="16" height="16" fill="currentColor" style="margin-right: 2px; padding-bottom: 2px">
          <path d="M256 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 160-160 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l160 0 0 160c0 17.7 14.3 32 32 32s32-14.3 32-32l0-160 160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-160 0 0-160z"/>
        </svg>
        <span data-i18n="dashboard.add">Add</span>
      </button>
      <button type="button" class="btn btn-primary" style="font-size: 0.9rem; margin-left:5px; width: 150px; height:40px; border-radius: 100px" data-bs-toggle="modal" data-bs-target="#dashboardModal">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="16" height="16" fill="currentColor" style="margin-right: 2px; padding-bottom: 2px">
          <path d="M64 64c0-17.7-14.3-32-32-32S0 46.3 0 64L0 400c0 44.2 35.8 80 80 80l400 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L80 416c-8.8 0-16-7.2-16-16L64 64zm406.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L320 210.7 262.6 153.4c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l73.4-73.4 57.4 57.4c12.5 12.5 32.8 12.5 45.3 0l128-128z"/>
        </svg>
        <span data-i18n="dashboard.filter">Filter</span>
      </button>
    </div>

    <!-- Chart & Legend Box -->
    <div class="row chart-container">
      <div id="noDataMessage" class="no-data" style="display: none; width: 100%;" data-i18n="dashboard.no_expenses">There are no expenses.</div>
      <div class="col-lg-6 chart-box">
        <canvas id="chartCanvas"></canvas>
      </div>
      <div id="customLegend" class="col-lg-6 legend-box"></div>
    </div>

    <!-- Cashflow Section -->
    <div id="cashflow-section" class="cashflow-container" style="display: none">
      <div class="cashflow-item income">
        <div class="cashflow-header">
          <div class="cashflow-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941" />
            </svg>
          </div>
          <div class="cashflow-label" data-i18n="dashboard.cashflow.income">Income</div>
        </div>
        <div class="cashflow-value" id="cashflow-income"></div>
      </div>
      <div class="cashflow-item expenses">
        <div class="cashflow-header">
          <div class="cashflow-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6 9 12.75l4.286-4.286a11.948 11.948 0 0 1 4.306 6.43l.776 2.898m0 0 3.182-5.511m-3.182 5.51-5.511-3.181" />
            </svg>
          </div>
          <div class="cashflow-label" data-i18n="dashboard.cashflow.expenses">Expenses</div>
        </div>
        <div class="cashflow-value" id="cashflow-expenses"></div>
      </div>
      <div class="cashflow-item balance">
        <div class="cashflow-header">
          <div class="cashflow-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
          </div>
          <div class="cashflow-label" data-i18n="dashboard.cashflow.balance">Balance</div>
        </div>
        <div class="cashflow-value" id="cashflow-balance"></div>
      </div>
    </div>
  </main>

  <main class="container">
    <!-- Dashboard Modal -->
    <div class="modal fade" id="dashboardModal" tabindex="-1" aria-labelledby="dashboardModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <form id="dashboardForm" class="modal-content" onsubmit="submitDashboard(event)">
          <div class="modal-header">
            <h5 class="modal-title" id="dashboardModalLabel" data-i18n="dashboard.modal.title">Change Dashboard</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p data-i18n="dashboard.modal.select_prompt">Select a dashboard to view:</p>
            <div class="form-check mb-1">
              <input class="form-check-input" type="radio" name="range" value="currentMonth" id="currentMonthRadio" checked>
              <label class="form-check-label" for="currentMonthRadio" data-i18n="dashboard.modal.current_month">
                Current Month
              </label>
            </div>
            <div class="form-check mb-1">
              <input class="form-check-input" type="radio" name="range" value="lastThreeMonths" id="lastThreeMonthsRadio">
              <label class="form-check-label" for="lastThreeMonthsRadio" data-i18n="dashboard.modal.past_3_months">
                Last 3 Months
              </label>
            </div>
            <div class="form-check mb-1">
              <input class="form-check-input" type="radio" name="range" value="lastSixMonths" id="lastSixMonthsRadio">
              <label class="form-check-label" for="lastSixMonthsRadio" data-i18n="dashboard.modal.past_6_months">
                Last 6 Months
              </label>
            </div>
            <div class="form-check mb-1">
              <input class="form-check-input" type="radio" name="range" value="lastYear" id="lastYearRadio">
              <label class="form-check-label" for="lastYearRadio" data-i18n="dashboard.modal.past_12_months">
                Last 12 Months
              </label>
            </div>
            <div class="form-check mb-1">
              <input class="form-check-input" type="radio" name="range" value="yearToDate" id="yearToDateRadio">
              <label class="form-check-label" for="yearToDateRadio" data-i18n="dashboard.modal.year_to_date">
                Year to Date
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="range" value="allData" id="allDataRadio">
              <label class="form-check-label" for="allDataRadio" data-i18n="dashboard.modal.to_date">
                All Data
              </label>
            </div>
            <div class="form-check mb-1">
              <input class="form-check-input" type="radio" name="range" value="customRange" id="customRangeRadio">
              <label class="form-check-label" for="customRangeRadio" data-i18n="dashboard.modal.custom_range">
                Custom Range
              </label>
            </div>
            <div id="customRangeInputs" class="custom-range-inputs">
              <div class="mb-3">
                <label class="form-label d-block mb-2" data-i18n="dashboard.modal.from">From</label>
                <div class="row g-2">
                  <div class="col-7">
                    <select class="form-select" id="fromMonthSelect" required>
                      <option value="" data-i18n="common.months.select_month">Select month</option>
                      <option value="01" data-i18n="common.months.january">January</option>
                      <option value="02" data-i18n="common.months.february">February</option>
                      <option value="03" data-i18n="common.months.march">March</option>
                      <option value="04" data-i18n="common.months.april">April</option>
                      <option value="05" data-i18n="common.months.may">May</option>
                      <option value="06" data-i18n="common.months.june">June</option>
                      <option value="07" data-i18n="common.months.july">July</option>
                      <option value="08" data-i18n="common.months.august">August</option>
                      <option value="09" data-i18n="common.months.september">September</option>
                      <option value="10" data-i18n="common.months.october">October</option>
                      <option value="11" data-i18n="common.months.november">November</option>
                      <option value="12" data-i18n="common.months.december">December</option>
                    </select>
                  </div>
                  <div class="col-5">
                    <input type="number" class="form-control" id="fromYearSelect" placeholder="Year" data-i18n-placeholder="common.year_placeholder" min="2000" max="2100" inputmode="numeric" pattern="[0-9]*" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 4)" required>
                  </div>
                </div>
              </div>
              <div class="mb-2">
                <label class="form-label d-block mb-2" data-i18n="dashboard.modal.to">To</label>
                <div class="row g-2">
                  <div class="col-7">
                    <select class="form-select" id="toMonthSelect" required>
                      <option value="" data-i18n="common.months.select_month">Select month</option>
                      <option value="01" data-i18n="common.months.january">January</option>
                      <option value="02" data-i18n="common.months.february">February</option>
                      <option value="03" data-i18n="common.months.march">March</option>
                      <option value="04" data-i18n="common.months.april">April</option>
                      <option value="05" data-i18n="common.months.may">May</option>
                      <option value="06" data-i18n="common.months.june">June</option>
                      <option value="07" data-i18n="common.months.july">July</option>
                      <option value="08" data-i18n="common.months.august">August</option>
                      <option value="09" data-i18n="common.months.september">September</option>
                      <option value="10" data-i18n="common.months.october">October</option>
                      <option value="11" data-i18n="common.months.november">November</option>
                      <option value="12" data-i18n="common.months.december">December</option>
                    </select>
                  </div>
                  <div class="col-5">
                    <input type="number" class="form-control" id="toYearSelect" placeholder="Year" data-i18n-placeholder="common.year_placeholder" min="2000" max="2100" inputmode="numeric" pattern="[0-9]*" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 4)" required>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="width: 120px" data-i18n="common.cancel">Cancel</button>
            <button type="submit" class="btn btn-primary" id="dashboardModalSubmitButton" style="width: 120px" data-i18n="dashboard.modal.apply">Change</button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <!-- Transaction Modal (Add and Edit) -->
  <div class="modal fade" id="transactionModal" tabindex="-1" aria-labelledby="transactionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <form id="transactionForm" class="modal-content" onsubmit="submitTransaction(event)">
        <div class="modal-header">
          <h5 class="modal-title" id="transactionModalLabel" data-i18n="transactions.modal_add_title">Add Transaction</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          <!-- Name -->
          <div class="mb-3">
            <label for="nameInput" class="form-label" data-i18n="transactions.name_label">Name</label>
            <input type="text" class="form-control" id="nameInput" name="name" placeholder="Enter name" data-i18n-placeholder="transactions.name_placeholder" required />
          </div>

          <!-- Category -->
          <div class="mb-3">
            <label for="categorySelect" class="form-label" data-i18n="transactions.category_label">Category</label>
            <select class="form-select" id="categorySelect" name="category" required></select>
          </div>

          <!-- Tags -->
          <div class="mb-3">
            <label class="form-label" data-i18n="transactions.tags_label">Tags</label>
            <input id="tagsInput" name="tags" type="text" class="form-control" value="" placeholder="Add a tag and press Enter" data-i18n-placeholder="transactions.tags_placeholder" autocomplete="off">
          </div>

          <!-- Amount -->
          <div class="mb-3">
            <label for="amountInput" class="form-label" data-i18n="transactions.amount_label">Amount</label>
            <input type="text" inputmode="decimal" class="form-control" id="amountInput" name="amount" min="0.01" step="0.01" placeholder="0.00" data-i18n-placeholder="transactions.amount_placeholder" required />
          </div>

          <!-- Type -->
          <div class="mb-3">
            <label for="typeSelect" class="form-label" data-i18n="transactions.type_label">Type</label>
            <select class="form-select" id="typeSelect" name="type" required>
              <option value="expense" data-i18n="transactions.type_expense">Expense</option>
              <option value="income" data-i18n="transactions.type_income">Income</option>
            </select>
          </div>

          <!-- Date -->
          <div>
            <label for="dateInput" class="form-label" data-i18n="transactions.date_label">Date</label>
            <input type="date" class="form-control" id="dateInput" name="date" required />
          </div>

          <!-- Recurring -->
          <div id="recurringElement" class="form-check mt-3">
            <input class="form-check-input" type="checkbox" value="" id="recurringCheck" name="recurringCheck" onchange="toggleRecurring(event.target.checked)" />
            <label class="form-check-label" for="recurringCheck" data-i18n="transactions.recurring_label">
              Recurring
            </label>
          </div>

          <div id="recurringDiv" class="card mt-3" style="display: none;">
            <div class="card-body">
              <div class="row">
                <!-- Start Date -->
                <div class="col-6 mb-3">
                  <label for="startDateInput" class="form-label" data-i18n="transactions.start_date_label">Start Date</label>
                  <input type="date" class="form-control" id="startDateInput" name="startDate" />
                </div>
                <!-- End Date -->
                <div class="col-6 mb-3">
                  <label for="endDateInput" class="form-label" data-i18n="transactions.end_date_label">End Date</label>
                  <input type="date" class="form-control" id="endDateInput" name="endDate" />
                </div>
              </div>

              <!-- Frequency -->
              <div>
                <label for="frequencySelect" class="form-label" data-i18n="transactions.frequency_label">Frequency</label>
                <select class="form-select" id="frequencySelect" name="frequency">
                  <option value="" disabled selected data-i18n="transactions.frequency_placeholder">Select frequency</option>
                  <option value="daily" data-i18n="transactions.frequency_daily">Daily</option>
                  <option value="weekly" data-i18n="transactions.frequency_weekly">Weekly</option>
                  <option value="monthly" data-i18n="transactions.frequency_monthly">Monthly</option>
                  <option value="yearly" data-i18n="transactions.frequency_yearly">Yearly</option>
                </select>
              </div>
            </div>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="width: 120px" data-i18n="common.cancel">Cancel</button>
          <button type="submit" class="btn btn-success" id="modalSubmitButton" style="width: 120px" data-i18n="transactions.add">Add</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Transaction Modal Delete -->
  <div class="modal fade" id="transactionModalDelete" tabindex="-1" aria-labelledby="transactionModalDeleteLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <form class="modal-content" onsubmit="submitTransaction(event)">
        <div class="modal-header">
          <h5 class="modal-title" id="transactionModalDeleteLabel" data-i18n="transactions.modal_delete_title">Delete Transaction</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" data-i18n="transactions.delete_confirm">
          Are you sure you want to delete this transaction?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="width: 120px" data-i18n="common.cancel">Cancel</button>
          <button type="submit" class="btn btn-danger" style="width: 120px" data-i18n="common.delete">Delete</button>
        </div>
      </form>
    </div>
  </div>
  <script src="js/index.js"></script>
</body>
</html>
