<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wally | Transactions</title>
  <link rel="icon" type="image/png" href="assets/wally.png">
  <meta name="robots" content="index,follow" />
  <meta name="description" content="A lightweight, self-hosted expense tracker that makes it easy to manage your finances." />
  <meta property="author" content="Pol Alzina" />
  <meta property="og:title" content="Wally" />
  <meta property="og:description" content="A lightweight, self-hosted expense tracker that makes it easy to manage your finances." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="assets/wally.png" />
  <!-- CSS -->
  <link href="css/vendors/bootstrap.min.css" rel="stylesheet">
  <link href="css/vendors/tom-select.min.css" rel="stylesheet">
  <link href="css/vendors/tom-select.bootstrap5.min.css" rel="stylesheet">
  <link href="css/transactions.css" rel="stylesheet">
  <!-- JS -->
  <script src="js/vendors/bootstrap.bundle.min.js" defer></script>
  <script src="js/vendors/bootstrap-show-toast.js" defer></script>
  <script src="js/vendors/ag-grid-community.min.noStyle.js"></script>
  <script src="js/vendors/tom-select.complete.min.js"></script>
  <script src="js/vendors/decimal.min.js"></script>
  <script src="js/i18n.js"></script>
  <script src="js/transactions.js"></script>


  <script>
    (function() {
      const theme = localStorage.getItem('theme') || 'system';
      const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (theme === 'light' || (theme === 'system' && !systemPrefersDark)) {
        document.documentElement.setAttribute('data-bs-theme', 'light');
      }
      else {
        document.documentElement.setAttribute('data-bs-theme', 'dark');
      }
    })();
  </script>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light">
        <a class="navbar-brand d-flex align-items-center" style="margin-left:10px; margin-right:30px" href="/">
          <img src="assets/wally.png" alt="Wally" width="50" height="50" style="margin-bottom: 5px; margin-right: 8px;">
          <span style="font-size: 1.8rem; font-weight:600;">Wally</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item" style="margin-left: 10px"><a class="nav-link" href="/" data-i18n="nav.dashboards">Dashboards</a></li>
            <li class="nav-item" style="margin-left: 10px"><a class="nav-link active" href="transactions" style="font-weight: 500" data-i18n="nav.transactions">Transactions</a></li>
            <li class="nav-item" style="margin-left: 10px"><a class="nav-link" href="settings" data-i18n="nav.settings">Settings</a></li>
          </ul>
          <ul id="logoutButton" class="navbar-nav ms-auto" style="display: none;">
            <li class="nav-item nav-link" style="margin-left: 10px; cursor: pointer;" title="Logout" data-i18n-title="nav.logout_title" onclick="logout()">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--pill-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2" />
                <path d="M9 12h12l-3 -3" />
                <path d="M18 15l3 -3" />
              </svg>
            </li>
          </ul>
        </div>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container my-2">

    <!-- Month Header -->
    <div id="monthHeader" class="month-navigation">
      <div id="prevMonth" style="cursor: pointer;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="22" height="22" fill="currentColor">
          <path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 288 480 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-370.7 0 105.4-105.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/>
        </svg>
      </div>
      <div id="currentMonth" class="current-month"></div>
      <div id="nextMonth" style="cursor: pointer;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="22" height="22" fill="currentColor">
          <path d="M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l370.7 0-105.4 105.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z"/>
        </svg>
      </div>
    </div>

    <div id="monthHeaderAll" class="month-navigation" style="display: none; height: 40px">
      <div class="current-month" data-i18n="dashboard.modal.to_date">All Transactions</div>
    </div>

    <!-- Action buttons -->
    <div id="actionButtonsContainer" class="d-flex flex-wrap justify-content-center align-items-center mb-4" style="margin-top: 20px; gap: 5px;">
      <button type="button" class="btn btn-success d-flex align-items-center justify-content-center btn-action" data-bs-toggle="modal" data-bs-target="#transactionModal" onclick="addTransaction()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="16" height="16" fill="currentColor">
          <path d="M256 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 160-160 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l160 0 0 160c0 17.7 14.3 32 32 32s32-14.3 32-32l0-160 160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-160 0 0-160z"/>
        </svg>
        <span class="btn-text" data-i18n="transactions.add">Add</span>
      </button>
      <button id="deleteSelectedBtn" type="button" class="btn btn-danger align-items-center justify-content-center btn-action" style="display:none;" onclick="deleteSelectedTransactions()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="16" height="16" fill="currentColor">
          <path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"/>
        </svg>
        <span class="btn-text">Delete (</span><span id="selectedCount">0</span><span class="btn-text">)</span>
      </button>
      <div class="d-flex justify-content-center">
        <label class="btn btn-primary d-flex align-items-center gap-2 justify-content-center btn-action" style="user-select:none; cursor:pointer;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="16" height="16" fill="currentColor">
            <path d="M40 48C26.7 48 16 58.7 16 72l0 48c0 13.3 10.7 24 24 24l48 0c13.3 0 24-10.7 24-24l0-48c0-13.3-10.7-24-24-24L40 48zM192 64c-17.7 0-32 14.3-32 32s14.3 32 32 32l288 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L192 64zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32l288 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-288 0zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32l288 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-288 0zM16 232l0 48c0 13.3 10.7 24 24 24l48 0c13.3 0 24-10.7 24-24l0-48c0-13.3-10.7-24-24-24l-48 0c-13.3 0-24 10.7-24 24zM40 368c-13.3 0-24 10.7-24 24l0 48c0 13.3 10.7 24 24 24l48 0c13.3 0 24-10.7 24-24l0-48c0-13.3-10.7-24-24-24l-48 0z"/>
          </svg>
          <span class="btn-text" data-i18n="transactions.show_all">Show All</span>
          <input id="showAllTransactions" type="checkbox" class="form-check-input" style="margin: 0; display: none;" onchange="getTransactions()" />
        </label>
      </div>
    </div>

    <!-- Category Filter Indicator -->
    <div id="categoryFilterIndicator" class="justify-content-center mb-3" style="display: none;">
      <button type="button" class="btn d-flex align-items-center gap-2 category-filter-btn" onclick="clearCategoryFilter()" style="border-radius: 8px; padding: 8px 16px; font-size: 0.9rem; height: 40px; background-color: transparent; transition: all 0.2s ease;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="14" height="14" fill="currentColor" style="flex-shrink: 0;">
          <path d="M3.9 54.9C10.5 40.9 24.5 32 40 32l432 0c15.5 0 29.5 8.9 36.1 22.9s4.6 30.5-5.2 42.5L320 320.9 320 448c0 12.1-6.8 23.2-17.7 28.6s-23.8 4.3-33.5-3l-64-48c-8.1-6-12.8-15.5-12.8-25.6l0-79.1L9.1 97.3C-.7 85.4-2.8 68.8 3.9 54.9z"/>
        </svg>
        <span style="font-weight: 500;"><span data-i18n="transactions.filtered_by">Filtered by</span>: <span id="filteredCategoryName"></span></span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" width="10" height="10" fill="currentColor" style="flex-shrink: 0;">
          <path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/>
        </svg>
      </button>
    </div>

    <!-- Grid Filter -->
    <div class="mb-2">
      <input type="text" class="form-control" id="searchInput" placeholder="Search..." data-i18n-placeholder="transactions.search_placeholder" oninput="onFilterTextBoxChanged()" />
    </div>

    <!-- AG Grid Table -->
    <div id="myGrid"></div>

    <!-- AG Grid Table Footer -->
    <div id="myGridFooter" class="mt-3" style="text-align: center; font-size: 0.9rem; font-weight: 400">
      <span style="white-space: nowrap;"><span data-i18n="transactions.footer.rows">Rows</span>: <span id="rowCount" style="font-weight: 500; color:#007AFF">0</span></span> <span style="padding-left: 3px; padding-right:3px; font-weight: 100">|</span> <span style="white-space: nowrap;"><span data-i18n="transactions.footer.income">Income</span>: <span id="incomeAmount" style="font-weight: 500; color: #198754">0</span></span> <span style="padding-left: 3px; padding-right:3px; font-weight: 100">|</span> <span style="white-space: nowrap;"><span data-i18n="transactions.footer.expense">Expense</span>: <span id="expenseAmount" style="font-weight: 500; color:#ea4152">0</span></span>
    </div>
  </main>

  <!-- Transaction Modal (Add and Edit) -->
  <div class="modal fade" id="transactionModal" tabindex="-1" aria-labelledby="transactionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <form id="transactionForm" class="modal-content" onsubmit="submitTransaction(event)">
        <div class="modal-header">
          <h5 class="modal-title" id="transactionModalLabel" data-i18n="transactions.modal_add_title">Add Transaction</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          <!-- Name -->
          <div class="mb-3">
            <label for="nameInput" class="form-label" data-i18n="transactions.name_label">Name</label>
            <input type="text" class="form-control" id="nameInput" name="name" placeholder="Enter name" data-i18n-placeholder="transactions.name_placeholder" required autocomplete="off" />
          </div>

          <!-- Category -->
          <div class="mb-3">
            <label for="categorySelect" class="form-label" data-i18n="transactions.category_label">Category</label>
            <select class="form-select" id="categorySelect" name="category" required></select>
          </div>

          <!-- Tags -->
          <div class="mb-3">
            <label class="form-label" data-i18n="transactions.tags_label">Tags</label>
            <input id="tagsInput" name="tags" type="text" class="form-control" value="" placeholder="Add a tag and press Enter" data-i18n-placeholder="transactions.tags_placeholder" autocomplete="off">
          </div>

          <!-- Amount -->
          <div class="mb-3">
            <label for="amountInput" class="form-label" data-i18n="transactions.amount_label">Amount</label>
            <input type="text" inputmode="decimal" class="form-control" id="amountInput" name="amount" min="0.01" step="0.01" placeholder="0.00" data-i18n-placeholder="transactions.amount_placeholder" required />
          </div>

          <!-- Type -->
          <div class="mb-3">
            <label for="typeSelect" class="form-label" data-i18n="transactions.type_label">Type</label>
            <select class="form-select" id="typeSelect" name="type" required>
              <option value="expense" data-i18n="transactions.type_expense">Expense</option>
              <option value="income" data-i18n="transactions.type_income">Income</option>
            </select>
          </div>

          <!-- Date -->
          <div>
            <label for="dateInput" class="form-label" data-i18n="transactions.date_label">Date</label>
            <input type="date" class="form-control" id="dateInput" name="date" required />
          </div>

          <!-- Recurring -->
          <div id="recurringElement" class="form-check mt-3">
            <input class="form-check-input" type="checkbox" value="" id="recurringCheck" name="recurringCheck" onchange="toggleRecurring(event.target.checked)" />
            <label class="form-check-label" for="recurringCheck" data-i18n="transactions.recurring_label">
              Recurring
            </label>
          </div>

          <div id="recurringDiv" class="card mt-3" style="display: none;">
            <div class="card-body">
              <div class="row">
                <!-- Start Date -->
                <div class="col-6 mb-3">
                  <label for="startDateInput" class="form-label" data-i18n="transactions.start_date_label">Start Date</label>
                  <input type="date" class="form-control" id="startDateInput" name="startDate" />
                </div>
                <!-- End Date -->
                <div class="col-6 mb-3">
                  <label for="endDateInput" class="form-label" data-i18n="transactions.end_date_label">End Date</label>
                  <input type="date" class="form-control" id="endDateInput" name="endDate" />
                </div>
              </div>

              <!-- Frequency -->
              <div>
                <label for="frequencySelect" class="form-label" data-i18n="transactions.frequency_label">Frequency</label>
                <select class="form-select" id="frequencySelect" name="frequency">
                  <option value="" disabled selected data-i18n="transactions.frequency_placeholder">Select frequency</option>
                  <option value="daily" data-i18n="transactions.frequency_daily">Daily</option>
                  <option value="weekly" data-i18n="transactions.frequency_weekly">Weekly</option>
                  <option value="monthly" data-i18n="transactions.frequency_monthly">Monthly</option>
                  <option value="yearly" data-i18n="transactions.frequency_yearly">Yearly</option>
                </select>
              </div>
            </div>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="min-width: 120px" data-i18n="common.cancel">Cancel</button>
          <button type="submit" class="btn btn-success" id="modalSubmitButton" style="min-width: 120px" data-i18n="transactions.add">Add</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Transaction Modal Delete -->
  <div class="modal fade" id="transactionModalDelete" tabindex="-1" aria-labelledby="transactionModalDeleteLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <form class="modal-content" onsubmit="submitTransaction(event)">
        <div class="modal-header">
          <h5 class="modal-title" id="transactionModalDeleteLabel" data-i18n="transactions.modal_delete_title">Delete Transaction</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" data-i18n="transactions.delete_confirm">
          Are you sure you want to delete this transaction?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="min-width: 120px" data-i18n="common.cancel">Cancel</button>
          <button type="submit" class="btn btn-danger" style="min-width: 120px" data-i18n="common.delete">Delete</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Transaction Modal Delete Multiple -->
  <div class="modal fade" id="transactionModalDeleteMultiple" tabindex="-1" aria-labelledby="transactionModalDeleteMultipleLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <form class="modal-content" onsubmit="submitTransactionDeleteMultiple(event)">
        <div class="modal-header">
          <h5 class="modal-title" id="transactionModalDeleteMultipleLabel" data-i18n="transactions.delete_multiple_title">Delete Transactions</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete <strong><span id="deleteMultipleCount">0</span></strong> transaction<span id="deleteMultiplePlural">s</span>?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="width: 120px" data-i18n="common.cancel">Cancel</button>
          <button type="submit" class="btn btn-danger" style="width: 120px" data-i18n="common.delete">Delete</button>
        </div>
      </form>
    </div>
  </div>
  

